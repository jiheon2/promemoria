<!DOCTYPE html>
<html>
<head>
    <title>Pro Memoria - 분석 결과</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Poppins:wght@200;300;400;500&display=swap"
          rel="stylesheet">
    <script src="/js/modernizr.js"></script>
    <script src="https://kit.fontawesome.com/5693f8ac72.js" crossorigin="anonymous"></script>
    <style>
        @font-face {
            font-family: 'TTLaundryGothicB';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2403-2@1.0/TTLaundryGothicB.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        body {
            font-family: 'TTLaundryGothicB', sans-serif;
            font-size: 20px;
        }

        p {
            font-family: 'TTLaundryGothicB', sans-serif;
            font-size: 15px;
        }

        h1 {
            font-family: 'TTLaundryGothicB', sans-serif;
        }

        h2 {
            font-family: 'TTLaundryGothicB', sans-serif;
        }

        h3 {
            font-family: 'TTLaundryGothicB', sans-serif;
            font-size: 24px;
        }

        h5 {
            font-family: 'TTLaundryGothicB', sans-serif;
            font-size: 20px;
        }

        /* 중앙 컨텐츠 박스 스타일 */
        .content-box {
            width: 80%;
            height: 730px;
            margin: 50px auto;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 50px;
        }

        #content-box2, #content-box3 {
            height: 80%;
            border: 1px solid #89480a;
            background-color: #f6f4f0;
            border-radius: 20px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.05);
        }


        #resultTitle h3, #analyze-date {
            color: #89480a;
        }

        .result-section {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .status-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .status-section h2 {
            font-size: 24px;
            color: #89480a;
        }

        .badge {
            font-size: 18px;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-body" data-bs-spy="scroll" data-bs-target="#navbar" data-bs-root-margin="0px 0px -40%"
      data-bs-smooth-scroll="true" tabindex="0">

<!-- 스피너 -->
<div id="preloader">
      <span class="loader">
        <span class="loader-inner"></span>
      </span>
</div>
<!-- 스피너 -->

<!-- 헤더 -->
<div class="header-include"></div>
<!-- 헤더 -->

<!-- 메인 페이지 -->

<!-- 중앙 컨텐츠 박스 -->
<div class="content-box">
    <h1 id="user" class="text-center" style="color: #89480a;"></h1>
    <div class="d-flex justify-content-between mt-5">
        <!-- 왼쪽 박스 (비디오) -->
        <div id="content-box2" style="width: 48%; height: 525px">
            <div id="video" style="width: 100%; height: 100%">

            </div>
        </div>

        <!-- 오른쪽 박스 (분석 결과) -->
        <div id="content-box3" style="width: 48%; height: 525px">
            <h3 class="text-center" id="analyze-date" style="margin-top: 30px"></h3>
            <div class="result-section" style="height:80%; display: flex; align-items: center">
                <div style="display: flex; justify-content: space-between; width: 50%;">
                    <div id="resultTitle" style="width: 50%">
                        <h3>눈 깜빡임 :</h3>
                        <h3>정확도 :</h3>
                        <br>
                        <h3>입술 떨림 :</h3>
                        <h3>정확도 :</h3>
                        <br>
                        <h3>머리 기울기 :</h3>
                        <h3>정확도 :</h3>
                    </div>
                    <div id="resultContent" style="width: 50%;">
                        <h3 id="eye-status">정상</h3>
                        <h3 id="eye-accuracy">76%</h3>
                        <br>
                        <h3 id="lip-status">정상</h3>
                        <h3 id="lip-accuracy">99%</h3>
                        <br>
                        <h3 id="tilt-status">정상</h3>
                        <h3 id="tilt-accuracy">69%</h3>
                    </div>
                </div>
                <div class="text-center mt-4" style="width: 50%">
                    <h2>검사 결과</h2>
                    <div id="resWarning" class="badge bg-warning text-dark" style="display: none;">비정상</div>
                    <div id="resSuccess" class="badge bg-success text-white" style="display: block;">정상</div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 메인페이지 -->

<!-- 푸터 -->
<div class="footer-include"></div>
<!-- 푸터 -->

<script src="/js/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="/js/plugins.js"></script>
<script type="text/javascript" src="/js/script.js"></script>
<script src="/js/common.js"></script>
<script>
    $(document).ready(function () {
        $('.header-include').load('/header.html');
        $('.footer-include').load('/footer.html');
        getToken()
    });


    // 회원정보 불러오기 함수
    function userInfo() {
        // 컨트롤러에 요청하기
        $.ajax({
            url: "https://user.promemoriapm.kr/user/v1/userInfo",
            type: "post",
            dataType: "JSON",
            data: {userId: loginUserId},
            xhrFields: {
                withCredentials: true
            }
        }).then(
            function (json) {
                userInfo = json.data;
                console.log(userInfo.userId)
                console.log(userInfo.userName)

                const userElement = document.getElementById("user");
                userElement.innerText = `${userInfo.userName}님의 분석결과입니다.`
            },
            function () {
                alert("로그인 해주시길 바랍니다.");
                location.href = "/user/login.html";
            }
        );
    }


    // sessionStorage에서 데이터 가져오기
    const analyzeDataString = sessionStorage.getItem("analyzeData");

    if (analyzeDataString) {
        try {
            const analyzeData = JSON.parse(analyzeDataString);

            // 분석 날짜 설정
            const analyzeDateElement = document.getElementById("analyze-date");
            const dateParts = analyzeData.date.split('_');
            const formattedDate = `${dateParts[0].replace(/-/g, '-')} ${dateParts[1].replace(/-/g, ':')}`;
            analyzeDateElement.innerText = `분석일 : ${formattedDate}`;

            // 비디오 URL을 설정하여 영상 삽입 (유효성 검사 추가)
            const videoContainer = document.getElementById("video");
            if (analyzeData.videoUrl) {
                videoContainer.innerHTML = `<video controls src="${analyzeData.videoUrl}" width="100%" height="480px"></video>`;
            } else {
                videoContainer.innerText = "영상 URL이 제공되지 않았습니다.";
            }

            // 눈, 입술, 머리 기울기 상태 및 정확도 설정
            document.getElementById("eye-status").innerText = analyzeData.analyzeResult.results.eye.predicted_class === 0 ? "정상" : "비정상";
            document.getElementById("eye-accuracy").innerText = `${(analyzeData.analyzeResult.results.eye.probabilities[0][0] * 100).toFixed(2)}%`;

            document.getElementById("lip-status").innerText = analyzeData.analyzeResult.results.lip.predicted_class === 0 ? "정상" : "비정상";
            document.getElementById("lip-accuracy").innerText = `${(analyzeData.analyzeResult.results.lip.probabilities[0][0] * 100).toFixed(2)}%`;

            document.getElementById("tilt-status").innerText = analyzeData.analyzeResult.results.tilt.predicted_class === 0 ? "정상" : "비정상";
            document.getElementById("tilt-accuracy").innerText = `${(analyzeData.analyzeResult.results.tilt.probabilities[0][0] * 100).toFixed(2)}%`;

            // 전체 검사 결과 설정
            const normalCount = [
                analyzeData.analyzeResult.results.eye.predicted_class,
                analyzeData.analyzeResult.results.lip.predicted_class,
                analyzeData.analyzeResult.results.tilt.predicted_class
            ].filter(predClass => predClass === 0).length;

            if (normalCount >= 2) {
                // 정상 상태일 때
                document.getElementById("resWarning").style.display = "none";
                document.getElementById("resSuccess").style.display = "block";
                document.getElementById("resSuccess").style.width = "40%";
                document.getElementById("resSuccess").style.margin = "auto";
            } else {
                // 비정상 상태일 때
                document.getElementById("resWarning").style.display = "block";
                document.getElementById("resWarning").style.width = "40%";
                document.getElementById("resWarning").style.margin = "auto";
                document.getElementById("resSuccess").style.display = "none";
            }

        } catch (error) {
            console.error("JSON 파싱 오류:", error);
        }
    } else {
        console.error("sessionStorage에 분석 데이터가 없습니다.");
    }

    // 필요에 따라 데이터 삭제
    // sessionStorage.removeItem("analyzeData");
</script>
</body>
</html>